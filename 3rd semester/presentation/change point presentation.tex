\documentclass[intlimits, 9pt, unicode]{beamer}

\mode<presentation>
\usepackage[T2A]{fontenc}
%\usepackage[cp1251]{inputenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsthm}

\usefonttheme[onlymath]{serif}
\newcommand{\textblue}[1]{\textcolor{blue}{#1}}

\usepackage{beamerthemesplit}

\usetheme{Warsaw}
%\setbeamertemplate{page number in head/foot}[totalframenumber]

\setbeamercovered{transparent}
\beamertemplatenavigationsymbolsempty

\setbeamertemplate{footline}{%
\hfill \insertframenumber{}/\inserttotalframenumber\ \ \ \ }

%\setbeamerfont{footline}{series=\bfseries}
%\setbeamertemplate{footline}[frame number]

\title{Обнаружение разладки во временных рядах показов мобильной рекламы}
\author{К.В. Мерзляков, группа 622}
\institute{Санкт-Петербургский Государственный Университет \\
     Кафедра статистического моделирования
}
\date{
    18.05.2019
}

\AtBeginSection[]{
  \begin{frame}
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
    \usebeamerfont{title}\insertsectionhead\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}


\begin{document}

\begin{frame}
    \titlepage
\end{frame}

\begin{frame}
    \frametitle{Содержание}



    \begin{itemize}
    	\item Общие замечания
    \vspace{0.5cm}
	 \item Построение модели данных
    \vspace{0.5cm}
        \item Методы обнаружения разладки
    \vspace{0.5cm}
        \item Оценка качества
    \vspace{0.5cm}
        \item Моделирование данных
    \vspace{0.5cm}
        \item Применение моделей к смоделированным данным
    \end{itemize}


\end{frame}



\section{Общие замечания}


\begin{frame}
    \frametitle{Изменения в данных}

       \begin{columns}
    \begin{column}{0.25\textwidth}
    \centering
     Запрос
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_request}
     \end{figure}
     \end{column}
    \begin{column}{0.001\textwidth}
    \centering
	>
     \end{column}
    \begin{column}{0.25\textwidth}
    \centering
    Показ
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_impression}
     \end{figure}
    \end{column}
    \begin{column}{0.001\textwidth}
    \centering
    >
    \end{column}
    \begin{column}{0.25\textwidth}
    \centering
    Клик
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_click}
     \end{figure}
    \end{column}
    \begin{column}{0.001\textwidth}
    \centering
    >
    \end{column}
    \begin{column}{0.25\textwidth}
    \centering
     Конверсия
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_conversion}
     \end{figure}
     \end{column}
     \end{columns}

             \vspace{1.2cm}

       {\begin{columns}
        \begin{column}{5cm}
        Изменения на стороне пользователя
         \begin{itemize}
    		\item Популярность приложения
		\item Конкуренция
		\item Маркетинговая активность приложения
		\item ...
   	 \end{itemize}
        \end{column}

        \begin{column}{5cm}
        Изменения на стороне рекламной сети
         \begin{itemize}
    		\item Релиз новых функций
		\item Партнерство с новыми рекламодателями
		\item Новые способы таргетинга
		\item ...
   	 \end{itemize}
	 \end{column}
    \end{columns}}

 \end{frame}


\begin{frame}
    \frametitle{Временные ряды}
	
    {\begin{columns}
        \begin{column}{5.5cm}
 Временной ряд это ряд, состоящий из числовых значений упорядоченных по времени. Как правило, с равными промежутками времени между значениями (минута, час, день, неделя и т.д.)
 

\vspace{0.3cm}
\begin{table}[h!]
\centering
 \begin{tabular}{||c c||}
 \hline
 Time & Data \\ [0.5ex]
 \hline\hline
 18-Май-2019 19:00 & 435 098 \\
 \hline
 18-Май-2019 20:00 & 431 248  \\
 \hline
 18-Май-2019 21:00 & 420 329  \\
 \hline
 ... & ... \\ [1ex]
 \hline
\end{tabular}
\end{table}

	
\vspace{0.3cm} Формальное обозначение:
 $ X = (x_1, x_2, ... , x_{N-1} , x_N)  $

        \end{column}

\hspace{-0.5cm}
        \begin{column}{5cm}
Обычно, временной ряд может быть представлен в виде суммы его компонент $X = T + S + E$
        \begin{figure}
        \centering
	\textbf{Временной ряд. Пример разложения ряда на компоненты}
        \includegraphics[height=5cm]{images/impressions_stl_6}
	\end{figure}
	
        \end{column}
    \end{columns}}
\end{frame}

\begin{frame}
    \frametitle{Разладка во временных рядах}

    \begin{itemize}
    	\item Разладкой во временных рядах называют момент времени, в который произошло существенное изменение в структуре временного ряда
	\item Методы обнаружения разладки --- это группа методов, с помощью которых можно находить такие точки разладки
	\item Разладка может быть двух типов
		\begin{itemize}
			\item Локальная --- аномалия или выброс
			\item Глобальная --- изменение структуры ряда
		\end{itemize}
    \end{itemize}

    {\begin{columns}
        \begin{column}{5cm}
        \begin{figure}
        \centering
	\textbf{Локальная разладка}
        \includegraphics[height=3.5cm]{images/local_cp}
	\end{figure}
        \end{column}

        \begin{column}{5cm}
	\begin{figure}
    	\centering
	\textbf{Глобальная разладка}
        \includegraphics[height=3.5cm]{images/global_cp}
	\end{figure}
        \end{column}
    \end{columns}}

\end{frame}


\begin{frame}
    \frametitle{Мотивация}
Практическая польза:
    \begin{itemize}
    	\item Прогнозирование
	\item Извлечение тренда
    	\item Поиск проблем в исторических данных
	\item Реакция на изменения своевременно
    \end{itemize}


   \begin{columns}
        \begin{column}{5cm}
	\begin{figure}
		\textbf{Извлечение тренда без анализа разладок}
		\includegraphics[height=3.5cm]{images/trend_fallacy}
	\end{figure}
        \end{column}

        \begin{column}{5cm}
	\begin{figure}
		\textbf{Извлечение тренда с анализом разладок}
		\includegraphics[height=3.5cm]{images/trend_succeed}
	\end{figure}
        \end{column}
    \end{columns}

Что можно сделать после обнаружения разладки:
    \begin{itemize}
    	\item Убрать/изменить выбросы
	\item Разбить временной ряд на подряды и анализировать каждый отдельно
    \end{itemize}

\end{frame}


\begin{frame}
    \frametitle{Виды разладок}

\begin{columns}
 \begin{column}{0.5\textwidth}

  \begin{columns}
      \begin{column}{0.3\textwidth}
      \centering
      Изменение в тренде
      \end{column}
      \begin{column}{0.5\textwidth}
      \begin{figure}
		\includegraphics[scale=0.08]{images/examples_trend}
	\end{figure}
	\end{column}
     \end{columns}

  \begin{columns}
      \begin{column}{0.3\textwidth}
      \centering
      Изменение в среднем
      \end{column}
      \begin{column}{0.5\textwidth}
      \begin{figure}
		\includegraphics[scale=0.08]{images/examples_mean}
	\end{figure}
	\end{column}
     \end{columns}

  \begin{columns}
      \begin{column}{0.3\textwidth}
      \centering
      Изменение в амплитуде колебаний
      \end{column}
      \begin{column}{0.5\textwidth}
      \begin{figure}
		\includegraphics[scale=0.08]{images/examples_variance}
	\end{figure}
	\end{column}
     \end{columns}

	\end{column}

 \begin{column}{0.5\textwidth}

  \begin{columns}
      \begin{column}{0.3\textwidth}
      \centering
      Локальное изменение
      \end{column}
      \begin{column}{0.5\textwidth}
      \begin{figure}
		\includegraphics[scale=0.08]{images/examples_outlier}
	\end{figure}
	\end{column}
     \end{columns}

  \begin{columns}
      \begin{column}{0.3\textwidth}
      \centering
      Изменение в периодике
      \end{column}
      \begin{column}{0.5\textwidth}
      \begin{figure}
		\includegraphics[scale=0.08]{images/examples_periodic}
	\end{figure}
	\end{column}
     \end{columns}

	\end{column}
	
     \end{columns}

\end{frame}

\begin{frame}
    \frametitle{Структура исследования}

    \begin{itemize}
    	\item Смоделировать данные, близкие к реальным
    \vspace{0.5cm}
	 \item Применить к смоделированным данным набор методов
    \vspace{0.5cm}
        \item Оценить и сравнить качество примененных методов
    \end{itemize}


\end{frame}




\section{Построение модели данных}

\begin{frame}
\frametitle{Данные мобильной рекламы}

   \begin{columns}
    \begin{column}{0.25\textwidth}
    \centering
     Запрос
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_request}
     \end{figure}
     \end{column}
    \begin{column}{0.001\textwidth}
    \centering
	>
     \end{column}
    \begin{column}{0.25\textwidth}
    \centering
    Показ
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_impression}
     \end{figure}
    \end{column}
    \begin{column}{0.001\textwidth}
    \centering
    >
    \end{column}
    \begin{column}{0.25\textwidth}
    \centering
    Клик
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_click}
     \end{figure}
    \end{column}
    \begin{column}{0.001\textwidth}
    \centering
    >
    \end{column}
    \begin{column}{0.25\textwidth}
    \centering
     Конверсия
     \begin{figure}
	\includegraphics[height=1cm]{images/scheme_conversion}
     \end{figure}
     \end{column}
     \end{columns}

   \begin{columns}
    \begin{column}{0.5\textwidth}
	\begin{figure}
	\textbf{Типичный будний день}\par\medskip
	\includegraphics[height=4.5cm]{images/examples_day}
	\end{figure}
     \end{column}
    \begin{column}{0.5\textwidth}
	\begin{figure}
	\textbf{Типичный выходной день}\par\medskip
	\includegraphics[height=4.5cm]{images/examples_weekend}
	\end{figure}
     \end{column}
     \end{columns}

\end{frame}

\begin{frame}
\frametitle{Примеры разладки в реальных данных}
\begin{figure}
\textbf{Изменение в среднем}\par\medskip
\includegraphics[scale=0.30]{images/1_examples_mean}
\end{figure}
\end{frame}

\begin{frame}
    \frametitle{Построение модели ряда}

    \begin{itemize}
    	\item Обозначим временной ряд $Y = (y_1, \dots, y_n)$
    \vspace{0.5cm}
	 \item Наблюдаемые значения можно представить в виде $Y = T + S + E$, где  $ T = (t_1, \dots, t_n) $ компонента-тренд, $ S = (s_1, \dots, s_n) $ периодическая компонента, $ E = (\epsilon_1, \dots, \epsilon_n) $ остатки или шум
    \vspace{0.5cm}
        \item Для каждой из этих компонент требуется построить модель
    \end{itemize}

\end{frame}


\begin{frame}
    \frametitle{Построение модели ряда}

Модель можно задать следующим образом:
\begin{equation*}
t_i = c, \quad i = 1, \dots, n, 
\end{equation*}

\begin{equation*}
s_i = \sum_{j=1}^{J}{A_j \cos \left( \frac{2\pi}{a_j} i + \phi_j \right)}, \quad i = 1, \dots, n,
\end{equation*}

\begin{equation*}
\epsilon_i \sim N(\mu, \sigma^2), \quad i = 1, \dots, n, 
\end{equation*}
где $i$ индекс элемента ряда; $j$ индекс косинуса в периодической компоненте; J --- количество косинусов в периодической компоненте; $c$ --- константа; $A_j$ --- амплитуда $j$-го косинуса; $a_j$ --- период $j$-го косинуса; $\phi_j$ --- фаза $j$-го косинуса.

\end{frame}


\begin{frame}
    \frametitle{Построение модели ряда}

Модель можно задать следующим образом:
\begin{itemize}
	\item Разладка только в одной точке ряда;
	\item Разладка только в тренде и заключается в сдвиге;
	\item Разладка может произойти не всегда, а с некоторой вероятностью $\rho$.
\end{itemize}
$\tau$ --- точка (индекс) разладки, тогда тренд с разладкой $ \tilde{T} = (\tilde{t_1}, \dots, \tilde{t_n}) $, где
\begin{equation*}
\tilde{t_i} =
	\begin{cases}
		t_i, & i < \tau, \\
		t_i + \delta, & i \geqslant \tau,
	\end{cases}
\end{equation*}

$ \delta $  --- значение разладки.

Значение разладки является случайной величиной с некоторым распределением. $ \delta^* \sim N(\mu^{\mathrm{(cp)}}, \sigma^{2\mathrm{(cp)}})  $:

\begin{equation*}
\delta = \begin{cases}
    		\delta^*, & \textrm{с вероятностью } \rho, \\
  		0, & \textrm{с вероятностью } 1 - \rho.
	\end{cases} 
\end{equation*}

Таким образом, моделируемый ряд с разладкой будет иметь следующий вид:
%\begin{equation*} Y = e^{\tilde{T} + S + E}.  \end{equation*}
\begin{equation*}
\tilde{Y} = e^{\tilde{T} + S + E}. 
\end{equation*}


\end{frame}

\section{Методы обнаружения разладки}


\begin{frame}
    \frametitle{Общая канва}

\begin{itemize}
	\item У временного ряда есть некоторая структура (сигнал)
	\item Сигнал может быть описан моделью
	\item Идея подхода: около точки разладки модель плохо описываетвременной ряд
	\item Используя меру ошибки мы можем измерять насколько хорошо описывает выбранная модель реальные данные
	\item Как только ошибка (отклонениемодели от реальных данных) превышает заданный порог, метод сигнализирует о разладке
\end{itemize}


Можно выделить два типа методов в данном подходе:
\begin{itemize}
	\item Методы на основе прогнозирования
	\item Методы на основе аппроксимации
\end{itemize}

\end{frame}


\begin{frame}
    \frametitle{Аппроксимация}

Пусть $l$ --- ширина окна. При этом  $ 1 < l < n $, $l$ чётное. С помощью ширины окна из исходного ряда образуется последовательность подрядов $W = \{ w_j \}_{j=1}^k$, где $k = n - l + 1$ --- количество таких подрядов; а $ w_j = (y_j, \dots, y_{j+l-1}) $ --- $j$-ый подряд. Каждый подряд  $w_j$  в свою очередь делится на два подряда одинаковой длины: $ W^{\mathrm{(left)}} = \{w_j^{\mathrm{(left)}} \}  =  \{(y_j, \dots, y_{j+\frac{l}{2}-1}) \}$ и $W^{\mathrm{(right)}} = \{w_j^{\mathrm{(right)}} \} = \{(y_{j+\frac{l}{2}}, \dots, y_{j+l-1}) \}$.

Таким образом, для каждого ряда $W$ можно сформировать тройки рядов: 

\begin{equation*}
W^{\mathrm{(all)}} = \{w_j^{\mathrm{(all)}} \}_{j=1}^k =  \{(w_j; w_j^{\mathrm{(left)}}; w_j^{\mathrm{(right)}}) \}_{j=1}^k. 
\end{equation*}

\end{frame}

\begin{frame}
    \frametitle{Аппроксимация}

Пусть есть функция ошибки $e(\cdot)$, такая что:
\begin{equation*}
e(X) = \min_{\theta}{\sum_{p=1}^m(x_p - f(x_p | \theta))^2 },
\end{equation*}
где $X = (x_1, \dots, x_m)$ ---  вещественный временной ряд длины $m$, а $f(x | \theta)$ --- модель сигнала этого временного ряда с параметрами $\theta$.

Функция $f(x|\theta)$ может быть константной ($\theta = (b)$):
\begin{equation*}
f(x | b) = b,
\end{equation*}
либо другой подходящей под наш ряд функцией, например:
\begin{equation*}
f(x | P, p, \chi) = P\cos(\frac{2\pi}{p}x + \chi) + b. 
\end{equation*}

\end{frame}

\begin{frame}
    \frametitle{Аппроксимация}

Мера ошибки позволяет нам рассчитать, насколько хорошо аппроксимируется отрезок ряда с помощью выбранной модели. Однако, для обнаружения самой разладки необходимо еще ввести функцию разладки:
\begin{equation*}
f_j = F(w_j^{\mathrm{(all)}} ) = \frac{e(w_j) - e(w_j^{\mathrm{(left)}}) - e(w_j^{\mathrm{(right)}})}{h}, 
\end{equation*}
где $h$ --- значение нормировки, $j = 1, \dots, k$.

Значения функции разладки синхронизируются с исходным рядом по последнему индексу окна. То есть $f_1$ соответствует $y_l$, а $f_k $ соответсвует $y_n$. Введем синхронизированную функцию разладки :

\begin{equation*}
q_i =
	\begin{cases}
		f_{i-l+1}, & i \geq l, \\
		0, & i < l.
	\end{cases}
\end{equation*}

Нормирующую константу можно рассчитывать как ненормированное значение функции разладки на первом отрезке ряда (предполагая, что на этом отрезке не происходило разладок):
\begin{equation*} 
h = e(w_1) - e(w_1^{\mathrm{(left)}}) - e(w_1^{\mathrm{(right)}}). 
\end{equation*}


\end{frame}

\begin{frame}
    \frametitle{Аппроксимация}

\begin{itemize}
	\item Итого, взяв ряд $Y$, мы «скользим» по нему окном ширины $l$
	\item Рассчитываем значения функции разладки $F()$ для каждого из получаемых подрядов $W^{\mathrm{(all)}}$
	\item Функция разладки начинает расти в окрестности точки разладки $\tau$,
	\item Следовательно можно задать порог $\gamma$, такой что при превышении функции разладки этого порога в какой-то точке $\hat{\tau}$, разладка будет обнаружена
\end{itemize}

 \begin{columns}
    \begin{column}{0.5\textwidth}
	\begin{figure}
	\includegraphics[height=4cm]{images/approaches_second_2_ru}
	\end{figure}
     \end{column}
    \begin{column}{0.5\textwidth}
	\begin{figure}
	\includegraphics[height=4cm]{images/approaches_second_3_ru}
	\end{figure}
     \end{column}
     \end{columns}

\end{frame}


\begin{frame}
    \frametitle{Прогнозирование}

\begin{itemize}
	\item Строим прогноз на несколько точек ряда вперед и считаем отклонение фактических значений от прогнозных
	\item В случае, если отклонение выше заданного порога, метод обнаруживает разладку
	\item Формально, оставаясь в тех же обозначениях, есть та же ширина окна $l$ 
	\item Есть последовательность подрядов $W = \{ w_j \}_{j=1}^k$
	\item  Каждый подряд  $w_j$ делится в этом методе на два ряда не обязательно одинаковой длины
	\item  Введем индекс $g$, который будет указывать в какой точке ряда $w_j$ он будет разделен на два
	\item  формируется набор из пар рядов:  $ W^{\mathrm{(left)}} = \{w_j^{\mathrm{(left)}} \}  =  (y_j, \dots, y_{j+g})$ и $W^{\mathrm{(right)}} = \{w_j^{\mathrm{(right)}} \} = (y_{j+g}, \dots, y_{j+l})$
\end{itemize}

\end{frame}

\begin{frame}
    \frametitle{Прогнозирование}


Ключевое отличие от методов аппроксимации: вместо расчета меры ошибки на том же ряду на котором подбирались параметры модели, мы оцениваем параметры $\theta$ модели $f(x|\theta)$ на ряде $ w_j^{\mathrm{(left)}} $, делаем прогноз на $ l - g $ точек и рассчитываем функцию ошибки $ e(\cdot) $ на ряде $ w_j^{\mathrm{(right)}} $. Функция разладки принимает следующий вид:
	\begin{equation*}
	 f_j = F(w_j^{\mathrm{(right)}}) = \frac{e(w_j^{\mathrm{(right)}})}{h}.
	 \end{equation*}

\begin{columns}
    \begin{column}{0.5\textwidth}
	\begin{figure}
	\includegraphics[height=3.8cm]{images/approaches_first_4_ru}
	\end{figure}
     \end{column}
    \begin{column}{0.5\textwidth}
	\begin{figure}
	\includegraphics[height=3.8cm]{images/approaches_first_6_ru}
	\end{figure}
     \end{column}
     \end{columns}

\end{frame}

\section{Оценка качества}

\begin{frame}
    \frametitle{Допущения}

В рамках данной работы мы разрабатываем систему своевременного оповещения о разладках во временных рядах.

\begin{itemize}
	\item Нам важны две характеристики: точность и скорость обнаружения разладки
	\item Нам точно известны ряды с разладками и без
	\item Можем строить матрицы сопряжённости и считать метрики качества
	\item Для простоты оценки качества методов мы фиксируем точку разладки $\tau$ параметром $n_0$, тем самым фиксируя приемлемую задержку обнаружения разладки на уровне $n - n_0$
\end{itemize}

\end{frame}


\begin{frame}
    \frametitle{Матрица сопряжённости}

Исходя из этого возможны четыре варианта:
\begin{itemize}
	\item Разладка произошла и метод обнаружил точку разладки \textbf{после} фактической точки $\tau$. Такая ситуация попадает под категорию True positive.
	\item Разладка произошла и метод не обнаружил точку разладки в диапазоне $(\tau, \cdots, n)$. Это случай False negative.
	\item Метод обнаружил разладку в диапазоне $(\tau, \cdots, n)$ в ряде без разладки. Это ситуация False positive.
	\item Разладки не было и метод не обнаружил разладку в диапазоне $(\tau, \cdots, n)$. Это случай True negative.
\end{itemize}

\end{frame}


\begin{frame}
    \frametitle{ROC-кривая}

Можно строить ROC-кривые (изменяя порог $\gamma$) для разных методов обнаружения разладки, сравнивая как работают те или иные методы в контролируемой среде эксперимента. 

Для сравнения качества методов мы будем пользоваться метрикой ROC-AUC, которая является ничем иным как площадью по ROC-кривой. 

\end{frame}

\section{Моделирование данных}

\begin{frame}
\frametitle{Реальные данные}

Моделировать ряд будем как сумму тренда, периодики и шума. Тренд будем брать за константу, а периодику зададим как сумму косинусов с определенными периодичностями, амплитудами и фазами.

\begin{figure}
\textbf{Пример реального ряда}\par\medskip
\includegraphics[scale=0.40]{images/examples_long_weekends}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{Оценка парамтеров}

С помощью процедуры ESPRIT нам удалось оценить следующие параметры периодической компоненты ряда:

\begin{itemize}
	\item Ряд можно смоделировать четырьмя косинусами $J=4$ с периодами $a_1 = 24, a_2 = 12, a_3 = 8, a_4 = 6$ (это логично, поскольку наши данные имеют суточные колебания).
	\item Оценка амплитуд данным методом получилась $A_1 = 1.05$, $A_2 = 0.82$, $A_3 = 0.27$, $A_4 = 0.05$
	\item А фазы косинусов возьмем $\phi_1 = \frac{3\pi}{4}$, $\phi_2 = \frac{\pi}{12}$, $\phi_3 = -\frac{2\pi}{3}$, $\phi_4 = -\frac{\pi}{3}$
\end{itemize}

Таким образом, модель периодической составляющей $s_i$ нашего ряда можно записать в следующем виде:
$$ s_i = 1.05\cos(\frac{2\pi}{24}i + \frac{3\pi}{4}) + 
                    0.82\cos(\frac{2\pi}{12}i + \frac{\pi}{12}) + 
                    0.27\cos(\frac{2\pi}{8}i - \frac{2\pi}{3}) + 
                    0.05\cos(\frac{2\pi}{6}i - \frac{\pi}{3}),$$
$\quad i = 1, \dots, n.$

\end{frame}

\begin{frame}
\frametitle{Прочие параметры модели}

\begin{itemize}
	\item Длину ряда зафиксируем $n = 400$
	\item Значение тренда пока что выберем нулевым: $c = 0$, то есть $t_i = 0, i = 1,\cdots, n$
	\item Параметры шума возьмем $\mu = 0, \sigma = 0.1$
\end{itemize}

В результате, моделируемые ряды получились внешне достаточно похожими на реальные данные:

\begin{figure}
%\textbf{Сравнение реального и моделируемого рядов}\par\medskip
\includegraphics[scale=0.22]{images/examples_real_vs_modeling}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{Моделирование разладки}

\begin{itemize}
	\item Вероятность возникновения разладки выберем $\rho = 0.8$
	\item Величину разладки $\delta^* \sim N(\mu = 1,\sigma = 0.4)$
	\item Место возникновения разладки зададим в самом конце ряда $n_0 = 396$ для изменения в среднем и локальной разладки
	\item Для изменения в тренде место возникновения разладки зададим с большей задержкой $n_0 = 328$
\end{itemize}

\begin{figure}
\textbf{Пример сгенерированного ряда с разладкой}\par\medskip
\includegraphics[scale=0.20]{images/data_modeling_example_2}
\end{figure}
\end{frame}


\section{Применение методов}

\begin{frame}
\frametitle{Моделирование рядов}

Попробуем применить, описанные выше модели к смоделированным данным.
\begin{itemize}
	\item Смоделируем 50 рядов
	\item У каждого ряда начало периодической компоненты выбирается случайно (то есть первый ряд может начинаться с нулевого часа, второй с пятого и т.п.). Это сделано, чтобы невелировать влияние периодичности на оценку качества метода.
	\item Параметры методов выбраны следующие. Длина окна $l$ принимает значения 2, 4, 24, 48, 96. Разладка возникает трех типов: локальная, разладка в среднем, разладка в тренде
	\item Список значений порогов выбирается следующим образом. Моделируются 50 отдельных рядов и на них запускается расчет значений функции разладки при заданном методе и заданных параметрах. Далее берется 95 квантиль из полученных значений. После чего берётся 100 значений в диапазоне от нуля до 95 квантили с равными промежутками.
\end{itemize}

\end{frame}

\begin{frame}
\frametitle{Методы}

Всего будем сравнивать между собой 9 методов:
\begin{itemize}
	\item Аппроксимация с выбранной моделью средним (или константной моделью)
	\item Аппроксимация с моделью из четырёх синусов с периодичностью 24, 12, 8, 6 и трендовой составляющей
	\item Аппроксимация с моделью из одного синуса с периодичностью 24 и тренда
	\item Аппроксимация с моделью только из тренда
	\item Прогнозирование с выбранной моделью средним (или константной моделью)
	\item Прогнозирование с моделью из четырёх синусов с периодичностью 24, 12, 8, 6 и трендовой составляющей
	\item Прогнозирование с моделью из одного синуса с периодичностью 24 и тренда
	\item Прогнозирование с моделью только из тренда
	\item Базовая простоя модель, в которой функция разладки это прирост текущих значений к значениям аналогичных часов сутки назад.
\end{itemize}

\end{frame}


\begin{frame}
\frametitle{Замечания}

Прежде, чем переходить к результатам следует оговорить следующие нюансы
\begin{itemize}
	\item Методы, в которых лежит хоть какая-то сложная модель (то есть отличные от модели среднего) бессмысленно применять для окон $l$ менее 48. Поскольку невозможно оценить какие либо параметры синуса, если длина ряда менее одного периода. 
	\item В случае с разладкой в тренде бессмысленно применять методы  с окном $l$ менее 48 по тем же причинам
\end{itemize}

\end{frame}


\begin{frame}
\frametitle{Результаты}

В таблице приведены сводные результаты для экспериментах на 50 временных рядах.

\begin{figure}
\textbf{Результаты применения методов к смоделированным данным}\par\medskip
\includegraphics[scale=0.40]{images/results_pivot}
\end{figure}


\end{frame}


\begin{frame}
\frametitle{Выводы}

\begin{itemize}
	\item Как мы видим, лучше всего сработал метод аппроксимации со средней моделью. Причем для разных типов разладки. Однако для каждого типа разладки у этого метода своя оптимальная длина окна
	\item Также, хорошо сработал метод аппроксимации с моделью из четырех синусов
	\item Базовый простой метод (в таблице это "naive") показал себя плохо. Причина тут в том, что наш ряд колеблется около нуля. Соответственно любые отклонения от нуля могут иметь очень большой прирост за счет эффекта низкой базы. Из-за этого базовый метод вероятно сработал бы неплохо в случае ряда с ненулевым средним, но в нашем случае он сработал плохо.
	\item В целом, результаты методов с использованием аппроксимации не столь существенно отличаются от результатов методов с использованием прогнозирования.

\end{itemize}

\end{frame}

\end{document}
